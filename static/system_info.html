<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuBan 边缘处理器 - 系统信息</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>LuBan 边缘处理器</h1>
        </header>

        <nav>
            <ul>
                <li><a href="index.html">实时预览</a></li>
                <li><a href="cameras.html">设备管理</a></li>
                <li><a href="camera_select.html">摄像头选择</a></li>
                <li><a href="system_info.html" class="active">系统信息</a></li>
            </ul>
        </nav>

        <main>
            <div class="card">
                <h2>系统信息</h2>

                <div id="loading" class="loading">正在加载系统信息...</div>
                <div id="error-message" class="message error hidden">无法加载系统信息</div>

                <div id="system-info" class="hidden">
                    <div class="card">
                        <h3>基本信息</h3>
                        <table class="info-table">
                            <tr>
                                <td>主机名:</td>
                                <td id="hostname">-</td>
                            </tr>
                            <tr>
                                <td>内核版本:</td>
                                <td id="kernel-version">-</td>
                            </tr>
                            <tr>
                                <td>CPU:</td>
                                <td id="cpu-info">-</td>
                            </tr>
                            <tr>
                                <td>CPU温度:</td>
                                <td id="cpu-temperature">-</td>
                            </tr>
                            <tr>
                                <td>运行时间:</td>
                                <td id="uptime">-</td>
                            </tr>
                        </table>
                    </div>

                    <div class="card">
                        <h3>资源使用情况</h3>
                        <div class="row">
                            <div class="col">
                                <h4>CPU使用率</h4>
                                <div class="progress">
                                    <div id="cpu-usage-bar" class="progress-bar progress-bar-primary" style="width: 0%;">0%</div>
                                </div>
                            </div>

                            <div class="col">
                                <h4>内存使用率</h4>
                                <div class="progress">
                                    <div id="memory-usage-bar" class="progress-bar progress-bar-primary" style="width: 0%;">0%</div>
                                </div>
                                <div id="memory-details" class="memory-details">
                                    <div>
                                        <strong>总内存:</strong>
                                        <span id="memory-total">-</span>
                                    </div>
                                    <div>
                                        <strong>已用内存:</strong>
                                        <span id="memory-used">-</span>
                                    </div>
                                    <div>
                                        <strong>可用内存:</strong>
                                        <span id="memory-free">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>存储信息</h3>
                        <div class="storage-card">
                            <h4>主存储</h4>
                            <div class="progress">
                                <div id="disk-usage-bar" class="progress-bar progress-bar-primary" style="width: 0%;">0%</div>
                            </div>
                            <div class="storage-details">
                                <div>
                                    <strong>总空间:</strong>
                                    <span id="disk-total">-</span>
                                </div>
                                <div>
                                    <strong>已用空间:</strong>
                                    <span id="disk-used">-</span>
                                </div>
                                <div>
                                    <strong>可用空间:</strong>
                                    <span id="disk-free">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>网络信息</h3>
                        <table class="info-table">
                            <tr>
                                <td>IP地址:</td>
                                <td id="ip-address">-</td>
                            </tr>
                            <tr>
                                <td>WiFi SSID:</td>
                                <td id="wifi-ssid">-</td>
                            </tr>
                            <tr>
                                <td>网络接口:</td>
                                <td id="network-interfaces">-</td>
                            </tr>
                        </table>
                    </div>

                    <div class="card">
                        <h3>服务器状态</h3>
                        <table class="info-table">
                            <tr>
                                <td>服务器版本:</td>
                                <td id="server-version">-</td>
                            </tr>
                            <tr>
                                <td>服务器运行时间:</td>
                                <td id="server-uptime">-</td>
                            </tr>
                            <tr>
                                <td>状态:</td>
                                <td><span id="server-status" class="status-ok">正常</span></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>&copy; 2023 LuBan 边缘处理器 | 版本: 0.1.0</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM元素
            const loadingDiv = document.getElementById('loading');
            const errorMessageDiv = document.getElementById('error-message');
            const systemInfoDiv = document.getElementById('system-info');

            // 加载系统信息
            loadSystemInfo();

            // 定期刷新系统信息
            setInterval(loadSystemInfo, 5000);

            // 加载系统信息
            function loadSystemInfo() {
                fetch('/systeminfo')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('获取系统信息失败');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 隐藏加载中和错误信息
                        loadingDiv.classList.add('hidden');
                        errorMessageDiv.classList.add('hidden');
                        systemInfoDiv.classList.remove('hidden');

                        // 更新基本信息
                        document.getElementById('hostname').textContent = data.hostname || '-';
                        document.getElementById('kernel-version').textContent = data.kernel_version || '-';
                        document.getElementById('cpu-info').textContent = data.cpu_info || 'RK3588';
                        document.getElementById('cpu-temperature').textContent = data.cpu_temperature ? `${data.cpu_temperature}°C` : '-';
                        document.getElementById('uptime').textContent = data.uptime || '-';

                        // 更新网络信息
                        let ipAddress = '-';
                        let wifiSsid = '-';
                        let networkInterfaces = '';

                        if (data.network && data.network.length > 0) {
                            // 查找WiFi接口
                            const wifiInterface = data.network.find(net => net.interface.startsWith('wl'));
                            if (wifiInterface) {
                                ipAddress = wifiInterface.ip_address;
                                wifiSsid = data.wifi_ssid || '-';
                            } else if (data.network[0]) {
                                // 如果没有WiFi接口，使用第一个接口的IP
                                ipAddress = data.network[0].ip_address;
                            }

                            // 构建网络接口列表
                            networkInterfaces = data.network.map(net =>
                                `${net.interface}: ${net.ip_address}`
                            ).join('<br>');
                        }

                        document.getElementById('ip-address').textContent = ipAddress;
                        document.getElementById('wifi-ssid').textContent = wifiSsid;
                        document.getElementById('network-interfaces').innerHTML = networkInterfaces;

                        // 更新CPU使用率
                        const cpuUsage = data.cpu_usage || 0;
                        const cpuUsageBar = document.getElementById('cpu-usage-bar');
                        cpuUsageBar.style.width = `${cpuUsage}%`;
                        cpuUsageBar.textContent = `${cpuUsage}%`;

                        // 根据使用率设置颜色
                        if (cpuUsage < 50) {
                            cpuUsageBar.className = 'progress-bar progress-bar-success';
                        } else if (cpuUsage < 80) {
                            cpuUsageBar.className = 'progress-bar progress-bar-warning';
                        } else {
                            cpuUsageBar.className = 'progress-bar progress-bar-danger';
                        }

                        // 更新内存使用率
                        const memoryUsage = data.memory_usage || 0;
                        const memoryUsageBar = document.getElementById('memory-usage-bar');
                        memoryUsageBar.style.width = `${memoryUsage}%`;
                        memoryUsageBar.textContent = `${memoryUsage}%`;

                        // 根据使用率设置颜色
                        if (memoryUsage < 50) {
                            memoryUsageBar.className = 'progress-bar progress-bar-success';
                        } else if (memoryUsage < 80) {
                            memoryUsageBar.className = 'progress-bar progress-bar-warning';
                        } else {
                            memoryUsageBar.className = 'progress-bar progress-bar-danger';
                        }

                        // 更新内存详情
                        document.getElementById('memory-total').textContent = data.memory_total || '-';
                        document.getElementById('memory-used').textContent = data.memory_used || '-';
                        document.getElementById('memory-free').textContent = data.memory_free || '-';

                        // 更新磁盘使用率
                        const diskUsage = data.disk_usage || 0;
                        const diskUsageBar = document.getElementById('disk-usage-bar');
                        diskUsageBar.style.width = `${diskUsage}%`;
                        diskUsageBar.textContent = `${diskUsage}%`;

                        // 根据使用率设置颜色
                        if (diskUsage < 50) {
                            diskUsageBar.className = 'progress-bar progress-bar-success';
                        } else if (diskUsage < 80) {
                            diskUsageBar.className = 'progress-bar progress-bar-warning';
                        } else {
                            diskUsageBar.className = 'progress-bar progress-bar-danger';
                        }

                        // 更新磁盘详情
                        document.getElementById('disk-total').textContent = data.disk_total || '-';
                        document.getElementById('disk-used').textContent = data.disk_used || '-';
                        document.getElementById('disk-free').textContent = data.disk_free || '-';

                        // 更新服务器信息
                        document.getElementById('server-version').textContent = data.server_version || '-';

                        // 计算服务器运行时间
                        const uptime = parseInt(data.server_uptime);
                        const hours = Math.floor(uptime / (1000 * 60 * 60));
                        const minutes = Math.floor((uptime % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((uptime % (1000 * 60)) / 1000);
                        document.getElementById('server-uptime').textContent = `${hours}小时 ${minutes}分钟 ${seconds}秒`;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        loadingDiv.classList.add('hidden');
                        errorMessageDiv.classList.remove('hidden');
                        systemInfoDiv.classList.add('hidden');
                    });
            }

            // 此函数已被移除，现在使用API返回的真实数据
        });
    </script>
</body>
</html>
